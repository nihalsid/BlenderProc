from typing import Union, List, Dict, Tuple

import numpy as np

# Common dataset palettes
_PALETTES = {
    "metropolis": {
        0: (32, 32, 32),
        1: (111, 74, 0),
        2: (120, 10, 10),
        3: (81, 0, 81),
        4: (111, 111, 0),
        5: (128, 64, 255),
        6: (170, 170, 170),
        7: (250, 170, 160),
        8: (96, 96, 96),
        9: (230, 150, 140),
        10: (128, 64, 128),
        11: (110, 110, 110),
        12: (110, 110, 110),
        13: (244, 35, 232),
        14: (128, 196, 128),
        15: (196, 196, 196),
        16: (190, 153, 153),
        17: (180, 165, 180),
        18: (90, 120, 150),
        19: (128, 128, 128),
        20: (102, 102, 156),
        21: (150, 100, 100),
        22: (70, 70, 70),
        23: (150, 150, 150),
        24: (150, 120, 90),
        25: (255, 255, 255),
        26: (255, 255, 255),
        27: (64, 170, 64),
        28: (230, 160, 50),
        29: (70, 130, 180),
        30: (190, 255, 255),
        31: (152, 251, 152),
        32: (107, 142, 35),
        33: (0, 170, 30),
        34: (70, 100, 150),
        35: (140, 140, 200),
        36: (220, 20, 60),
        37: (220, 10, 30),
        38: (255, 0, 0),
        39: (255, 0, 200),
        40: (250, 170, 26),
        41: (250, 170, 25),
        42: (250, 170, 24),
        43: (250, 170, 20),
        44: (255, 255, 255),
        45: (255, 255, 255),
        46: (250, 170, 15),
        47: (255, 255, 128),
        48: (250, 0, 30),
        49: (100, 140, 180),
        50: (220, 128, 128),
        51: (222, 40, 40),
        52: (100, 170, 30),
        53: (40, 40, 40),
        54: (33, 33, 33),
        55: (100, 128, 160),
        56: (250, 171, 30),
        57: (250, 174, 30),
        58: (250, 175, 30),
        59: (250, 176, 30),
        60: (210, 170, 100),
        61: (153, 153, 153),
        62: (128, 128, 128),
        63: (0, 0, 80),
        64: (250, 170, 30),
        65: (220, 220, 0),
        66: (140, 140, 20),
        67: (210, 170, 100),
        68: (210, 120, 50),
        69: (119, 11, 32),
        70: (0, 60, 100),
        71: (0, 0, 142),
        72: (128, 64, 64),
        73: (0, 0, 230),
        74: (128, 64, 64),
        75: (0, 0, 70),
        76: (0, 0, 192),
        77: (250, 170, 32),
        78: (250, 170, 33),
        79: (250, 170, 34),
        80: (250, 170, 37),
        81: (250, 170, 29),
        82: (250, 170, 12),
        83: (250, 170, 11),
        84: (255, 255, 255),
        85: (255, 255, 255),
        86: (255, 255, 255),
        87: (255, 255, 255),
    },
    "vistas": {
        0: (196, 196, 196),
        1: (190, 153, 153),
        2: (180, 165, 180),
        3: (90, 120, 150),
        4: (102, 102, 156),
        5: (128, 64, 255),
        6: (170, 170, 170),
        7: (250, 170, 160),
        8: (96, 96, 96),
        9: (230, 150, 140),
        10: (128, 64, 128),
        11: (110, 110, 110),
        12: (244, 35, 232),
        13: (150, 100, 100),
        14: (70, 70, 70),
        15: (150, 120, 90),
        16: (255, 255, 255),
        17: (64, 170, 64),
        18: (230, 160, 50),
        19: (70, 130, 180),
        20: (190, 255, 255),
        21: (152, 251, 152),
        22: (107, 142, 35),
        23: (0, 170, 30),
        24: (70, 100, 150),
        25: (0, 80, 100),
        26: (32, 32, 32),
        27: (120, 10, 10),
        28: (165, 42, 42),
        29: (0, 192, 0),
        30: (140, 140, 200),
        31: (220, 20, 60),
        32: (255, 0, 0),
        33: (255, 0, 100),
        34: (255, 0, 200),
        35: (200, 128, 128),
        36: (255, 255, 128),
        37: (250, 0, 30),
        38: (100, 140, 180),
        39: (220, 220, 220),
        40: (220, 128, 128),
        41: (222, 40, 40),
        42: (100, 170, 30),
        43: (40, 40, 40),
        44: (33, 33, 33),
        45: (100, 128, 160),
        46: (142, 0, 0),
        47: (210, 170, 100),
        48: (153, 153, 153),
        49: (128, 128, 128),
        50: (0, 0, 80),
        51: (250, 170, 30),
        52: (192, 192, 192),
        53: (220, 220, 0),
        54: (140, 140, 20),
        55: (119, 11, 32),
        56: (150, 0, 255),
        57: (0, 60, 100),
        58: (0, 0, 142),
        59: (0, 0, 90),
        60: (0, 0, 230),
        61: (128, 64, 64),
        62: (0, 0, 110),
        63: (0, 0, 70),
        64: (0, 0, 192),
    },
}

def get(
    name: str, format: str = "numpy"
) -> Union[
    List[Tuple[int, int, int]],
    Dict[int, Tuple[int, int, int]],
    np.ndarray
]:
    def to_list(palette):
        out = [[0, 0, 0] for _ in range(max(palette.keys()) + 1)]
        for k, v in palette.items():
            out[k] = v
        return out

    raw_palette = _PALETTES[name.lower()]

    if format == "numpy":
        return np.array(to_list(raw_palette), dtype=np.uint8)
    elif format == "list":
        return to_list(raw_palette)
    elif format == "dict":
        return raw_palette
    else:
        raise ValueError(f"Unknown format '{format}'")

